<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.59.1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Pythonä¸­ç­–ç•¥æ¨¡å¼çš„åº”ç”¨ï¼šä»¥ç”µå•†è´­ç‰©è½¦çš„æ‰“æŠ˜ç­–ç•¥ä¸ºä¾‹ | neo0moriarty</title>
    <meta property="og:title" content="Pythonä¸­ç­–ç•¥æ¨¡å¼çš„åº”ç”¨ï¼šä»¥ç”µå•†è´­ç‰©è½¦çš„æ‰“æŠ˜ç­–ç•¥ä¸ºä¾‹ - neo0moriarty">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2017-11-30T00:00:00&#43;08:00">
        
        
    <meta property="article:modified_time" content="2017-11-30T00:00:00&#43;08:00">
        
    <meta name="Keywords" content="[Pythonä¸­ç­–ç•¥æ¨¡å¼çš„åº”ç”¨ ä»¥ç”µå•†è´­ç‰©è½¦çš„æ‰“æŠ˜ç­–ç•¥çš„å®ç°ä¸ºä¾‹]">
    <meta name="description" content="Pythonä¸­ç­–ç•¥æ¨¡å¼çš„åº”ç”¨ï¼šä»¥ç”µå•†è´­ç‰©è½¦çš„æ‰“æŠ˜ç­–ç•¥ä¸ºä¾‹">
        
    <meta name="author" content="neo0moriarty">
    <meta property="og:url" content="https://neo0moriarty.github.io/python-strategy-order-discount/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/normalize.css">
    
        <link rel="stylesheet" href="/css/prism.css">
    
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    


    
    
</head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://neo0moriarty.github.io/">
                        neo0moriarty
                    </a>
                
                <p class="description">o(â•¯â–¡â•°)o  (ã‚œ-ã‚œ)ã¤ãƒ­  o(â•¯â–¡â•°)o</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://neo0moriarty.github.io/">é¦–é¡µ</a>
                    
                    <a  href="https://neo0moriarty.github.io/archives/" title="å½’æ¡£">å½’æ¡£</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
        
        
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">Pythonä¸­ç­–ç•¥æ¨¡å¼çš„åº”ç”¨ï¼šä»¥ç”µå•†è´­ç‰©è½¦çš„æ‰“æŠ˜ç­–ç•¥ä¸ºä¾‹</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2017å¹´11æœˆ30æ—¥
                        </date>
                        
                        
                        
                        <div class="post-content">
                            <p><a href="https://baike.baidu.com/item/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/646307?fr=aladdin">ç­–ç•¥æ¨¡å¼</a>æ˜¯å¸¸è§çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚æœ¬æ–‡æ¢è®¨Pythonä¸­å…³äºç­–ç•¥æ¨¡å¼çš„åº”ç”¨ï¼Œä»¥ç”µå•†è´­ç‰©è½¦çš„ä¸åŒæ‰“æŠ˜ç­–ç•¥çš„å®ç°ä¸ºä¾‹ï¼Œå¹¶<strong>ç¤ºèŒƒæ€ä¹ˆé€æ­¥ä¼˜åŒ–ä»£ç çš„å®ç°</strong>ã€‚</p>

<hr />

<h2 id="éœ€æ±‚æè¿°">éœ€æ±‚æè¿°</h2>

<p>å‡å¦‚ä¸€ä¸ªç½‘åº—åˆ¶å®šäº†ä¸‹è¿°æŠ˜æ‰£è§„åˆ™ï¼š
1ã€ æœ‰ 1000 æˆ–ä»¥ä¸Šç§¯åˆ†çš„é¡¾å®¢ï¼Œæ¯ä¸ªè®¢å•äº« 5% æŠ˜æ‰£ã€‚
2ã€ åŒä¸€è®¢å•ä¸­ï¼Œå•ä¸ªå•†å“çš„æ•°é‡è¾¾åˆ° 20 ä¸ªæˆ–ä»¥ä¸Šï¼Œäº« 10% æŠ˜æ‰£ã€‚
3ã€ è®¢å•ä¸­çš„ä¸åŒå•†å“è¾¾åˆ° 10 ä¸ªæˆ–ä»¥ä¸Šï¼Œäº« 7% æŠ˜æ‰£ã€‚</p>

<p>ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å‡å®šä¸€ä¸ªè®¢å•ä¸€æ¬¡åªèƒ½äº«ç”¨ä¸€ä¸ªæŠ˜æ‰£ã€‚</p>

<h2 id="éœ€æ±‚åˆ†æ">éœ€æ±‚åˆ†æ</h2>

<p>ä¸åŒçš„æ‰“æŠ˜ç­–ç•¥å¯¹åº”ç€è®¾è®¡æ¨¡å¼çš„ç­–ç•¥æ¨¡å¼ï¼Œä»¥ç­–ç•¥æ¨¡å¼çš„æ€è·¯æ¥è§£å†³é—®é¢˜å³å¯ã€‚</p>

<h2 id="ç”¨ç­–ç•¥ç±»å®ç°ç­–ç•¥æ¨¡å¼">ç”¨ç­–ç•¥ç±»å®ç°ç­–ç•¥æ¨¡å¼</h2>

<p>å…¸å‹çš„ç­–ç•¥å®ç°æ˜¯ä»¥ç­–ç•¥ç±»ä¸ºåŸºç¡€ï¼Œä¸åŒçš„ç­–ç•¥åˆ›å»ºä¸åŒçš„ç±»ã€‚
è§£å†³æ–¹æ¡ˆåˆ†æå¦‚ä¸‹ï¼š</p>

<p>ä¸Šä¸‹æ–‡</p>

<p>ã€€ã€€æŠŠä¸€äº›è®¡ç®—å§”æ‰˜ç»™å®ç°ä¸åŒç®—æ³•çš„å¯äº’æ¢ç»„ä»¶ï¼Œå®ƒæä¾›æœåŠ¡ã€‚åœ¨è¿™ä¸ªç”µå•†ç¤ºä¾‹ä¸­ï¼Œä¸Šä¸‹æ–‡æ˜¯ Orderï¼Œå®ƒä¼šæ ¹æ®ä¸åŒçš„ç®—æ³•è®¡ç®—ä¿ƒé”€æŠ˜æ‰£ã€‚</p>

<p>ç­–ç•¥</p>

<p>ã€€ã€€å®ç°ä¸åŒç®—æ³•çš„ç»„ä»¶å…±åŒçš„æ¥å£ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œåä¸º Promotion çš„æŠ½è±¡ç±»æ‰®æ¼”è¿™ä¸ªè§’è‰²ã€‚</p>

<p>å…·ä½“ç­–ç•¥</p>

<p>ã€€ã€€â€œç­–ç•¥â€çš„å…·ä½“å­ç±»ã€‚fidelityPromoã€BulkPromo å’Œ LargeOrderPromo æ˜¯è¿™é‡Œå®ç°çš„ä¸‰ä¸ªå…·ä½“ç­–ç•¥ã€‚</p>

<p>æŒ‰ç…§ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹ä¸€ä¹¦çš„è¯´æ˜ï¼Œå…·ä½“ç­–ç•¥ç”±ä¸Šä¸‹æ–‡ç±»çš„å®¢æˆ·é€‰æ‹©ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ ä¸­ï¼Œå®ä¾‹åŒ–è®¢å•ä¹‹å‰ï¼Œç³»ç»Ÿä¼šä»¥æŸç§æ–¹å¼é€‰æ‹©ä¸€ç§ä¿ƒé”€æŠ˜æ‰£ç­–ç•¥ï¼Œç„¶åæŠŠå®ƒä¼ ç»™ Order æ„é€ æ–¹æ³•ã€‚
å…·ä½“æ€ä¹ˆé€‰æ‹©ç­–ç•¥ï¼Œä¸åœ¨è¿™ä¸ªæ¨¡å¼çš„èŒè´£èŒƒå›´å†…ã€‚</p>

<p>å®ç° Order ç±»ï¼Œæ”¯æŒæ’å…¥å¼æŠ˜æ‰£ç­–ç•¥ã€‚</p>

<p>å®ç°ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code>from abc import ABC, abstractclassmethod
from collections import namedtuple

Customer = namedtuple('Customer', 'name fidelity')


class LineItem:
    '''è´­ç‰©è½¦æ¡ç›®ç±» æ¯ä¸ªæ¡ç›®æœ‰å±æ€§ï¼šäº§å“ ä»·æ ¼ æ•°é‡'''

    def __init__(self, product, quantity, price):
        self.product = product
        self.quantity = quantity
        self.price = price

    def total(self):
        '''è´­ç‰©è½¦ä¸€ä¸ªæ¡ç›®çš„æ€»ä»·'''
        return self.price * self.quantity


class Order:
    '''è®¢å•ç±» å®¢æˆ· è´­ç‰©è½¦ æŠ˜æ‰£ è®¡ç®—æ€»ä»·å’Œåº”ä»˜æ¬¾ '''

    def __init__(self, customer, cart, promotion):
        self.customer = customer
        self.cart = list(cart)
        self.promotion = promotion

    def total(self):
        '''æ‰“æŠ˜å‰çš„æ€»ä»·'''
        # if not hasattr(self, '__total'): # ä¸ºä»€ä¹ˆè¦åŠ è¿™å¥åˆ¤æ–­ï¼Ÿ
        #     self.__total = sum(item.total() for item in self.cart)
        # return self.__total
        return sum(item.total() for item in self.cart)

    def due(self):
        '''æ‰“æŠ˜åçš„åº”ä»˜æ¬¾'''
        if not self.promotion:
            discount = 0
        else:
            discount = self.promotion.discount(self)
        return self.total() - discount

    def __repr__(self):
        fmt = '&lt;Order total: {:.2f} due: {:.2f}&gt;'
        return fmt.format(self.total(), self.due())
        
        
class Promotion(ABC):
    '''åœ¨ Python 3.4 ä¸­ï¼Œå£°æ˜æŠ½è±¡åŸºç±»æœ€ç®€å•çš„æ–¹å¼æ˜¯å­ç±»åŒ– abc.ABCã€‚'''

    @abstractclassmethod
    def discount(self, order):
        pass


class FidelityPromo(Promotion):

    def discount(self, order):
        return order.total() * .05 if order.customer.fidelity &gt;= 1000 else 0



class BulkItemPromo(Promotion):

    def discount(self, order):
        discount = 0
        for item in order.cart:
            if item.quantity &gt;= 20:
                discount += item.total() * .1
        return discount


class LargeOrderPromo(Promotion):

    def discount(self, order):
        distinct_items = {item.product for item in order.cart}
        if len(distinct_items) &gt;= 10:
            return order.total() * .07
        return 0
</code></pre>

<p>æµ‹è¯•ç”¨ä¾‹ï¼š</p>

<pre><code>joe = Customer('John Doe', 0)
ann = Customer('Ann Smith', 1100)
cart = [LineItem('banana', 4, .5), 
        LineItem('apple', 10, 1.5), 
        LineItem('watermellon', 5, 5.0)]
print(Order(joe, cart, FidelityPromo()))
print(Order(ann, cart, FidelityPromo()))
banana_cart = [LineItem('banana', 30, .5), 
                LineItem('apple', 10, 1.5)]
print(Order(joe, banana_cart, BulkItemPromo()))
long_order = [LineItem(str(item_code), 1, 1.0) for item_code in range(10)]
print(Order(joe, long_order, LargeOrderPromo()))
print(Order(joe, cart, LargeOrderPromo()))
</code></pre>

<h2 id="ç”¨å‡½æ•°å®ç°ç­–ç•¥æ¨¡å¼">ç”¨å‡½æ•°å®ç°ç­–ç•¥æ¨¡å¼</h2>

<p>åˆ©ç”¨ Python ä¸­ä½œä¸ºå¯¹è±¡çš„å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨æ›´å°‘çš„ä»£ç å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚
æ¯ä¸ªå…·ä½“ç­–ç•¥éƒ½æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸”éƒ½åªå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå³ discountã€‚æ­¤å¤–ï¼Œç­–ç•¥å®ä¾‹æ²¡æœ‰çŠ¶æ€ï¼ˆæ²¡æœ‰å®ä¾‹å±æ€§ï¼‰ã€‚ä½ å¯èƒ½ä¼šè¯´ï¼Œå®ƒä»¬çœ‹èµ·æ¥åƒæ˜¯æ™®é€šçš„å‡½æ•°â€”â€”çš„ç¡®å¦‚æ­¤ã€‚å¯ä»¥æŠŠå…·ä½“ç­–ç•¥æ¢æˆç®€å•çš„å‡½æ•°ï¼Œå»æ‰ Promotion æŠ½è±¡ç±»ã€‚ç”¨å‡½æ•°åˆ†åˆ«å®ç°ä¸åŒçš„ä¿ƒé”€ç­–ç•¥ï¼Œå¹¶æŠŠä¿ƒé”€å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥å³å¯ã€‚</p>

<p>ä»¥ä¸‹æ˜¯é‡æ„ä¹‹åçš„å®ç°ï¼š</p>

<pre><code>from collections import namedtuple

Customer = namedtuple('Customer', 'name fidelity')


class LineItem:
    '''è´­ç‰©è½¦æ¡ç›®ç±» æ¯ä¸ªæ¡ç›®æœ‰å±æ€§ï¼šäº§å“ ä»·æ ¼ æ•°é‡'''

    def __init__(self, product, quantity, price):
        self.product = product
        self.quantity = quantity
        self.price = price

    def total(self):
        '''è´­ç‰©è½¦ä¸€ä¸ªæ¡ç›®çš„æ€»ä»·'''
        return self.price * self.quantity


class Order:
    '''è®¢å•ç±» å®¢æˆ· è´­ç‰©è½¦ æŠ˜æ‰£ è®¡ç®—æ€»ä»·å’Œåº”ä»˜æ¬¾ '''

    def __init__(self, customer, cart, promotion):
        self.customer = customer
        self.cart = list(cart)
        self.promotion = promotion

    def total(self):
        '''æ‰“æŠ˜å‰çš„æ€»ä»·'''
        # if not hasattr(self, '__total'): # ä¸ºä»€ä¹ˆè¦åŠ è¿™å¥åˆ¤æ–­ï¼Ÿ
        #     self.__total = sum(item.total() for item in self.cart)
        # return self.__total
        return sum(item.total() for item in self.cart)

    def due(self):
        '''æ‰“æŠ˜åçš„åº”ä»˜æ¬¾'''
        if not self.promotion:
            discount = 0
        else:
            discount = self.promotion(self)
        return self.total() - discount

    def __repr__(self):
        fmt = '&lt;Order total: {:.2f} due: {:.2f}&gt;'
        return fmt.format(self.total(), self.due())



def fidelity_promo(order):
    return order.total() * .05 if order.customer.fidelity &gt;= 1000 else 0

def bulk_item_promo(order):
    discount = 0
    for item in order.cart:
        if item.quantity &gt;= 20:
            discount += item.total() * .1
    return discount

def large_order_promo(order):
    distinct_items = {item.product for item in order.cart}
    if len(distinct_items) &gt;= 10:
        return order.total() * .07
    return 0
</code></pre>

<p>ä¸éš¾çœ‹å‡ºï¼Œç”¨å‡½æ•°å®ç°ç­–ç•¥åï¼Œå»æ‰äº†æŠ½è±¡ç±»å’Œç­–ç•¥ç±»ï¼Œä»£ç æ›´ç²¾ç®€ï¼Œä¹Ÿæ›´åŠ æ˜“è¯»ï¼Œ
æ–°çš„ Order ç±»ä½¿ç”¨èµ·æ¥æ›´ç®€å•ã€‚</p>

<p>æµ‹è¯•ç”¨ä¾‹ï¼š</p>

<pre><code>joe = Customer('John Doe', 0)
ann = Customer('Ann Smith', 1100)
cart = [LineItem('banana', 4, .5), 
        LineItem('apple', 10, 1.5), 
        LineItem('watermellon', 5, 5.0)]
print(Order(joe, cart, fidelity_promo))
print(Order(ann, cart, fidelity_promo))
banana_cart = [LineItem('banana', 30, .5), 
                LineItem('apple', 10, 1.5)]
print(Order(joe, banana_cart, bulk_item_promo))
long_order = [LineItem(str(item_code), 1, 1.0) for item_code in range(10)]
print(Order(joe, long_order, large_order_promo))
print(Order(joe, cart, large_order_promo))
</code></pre>

<p>å…·ä½“ç­–ç•¥ä¸€èˆ¬æ²¡æœ‰å†…éƒ¨çŠ¶æ€ï¼Œåªæ˜¯å¤„ç†ä¸Šä¸‹æ–‡ä¸­çš„æ•°æ®ã€‚æ­¤æ—¶ï¼Œé€‚åˆä½¿ç”¨æ™®é€šçš„å‡½æ•°ï¼Œåˆ«å»ç¼–å†™åªæœ‰ä¸€ä¸ªæ–¹æ³•çš„ç±»ï¼Œå†å»å®ç°å¦ä¸€ä¸ªç±»å£°æ˜çš„å•å‡½æ•°æ¥å£ã€‚å‡½æ•°æ¯”ç”¨æˆ·å®šä¹‰çš„ç±»çš„å®ä¾‹è½»é‡ï¼Œå› ä¸ºå„ä¸ªç­–ç•¥å‡½æ•°åœ¨ Python ç¼–è¯‘æ¨¡å—æ—¶åªä¼šåˆ›å»ºä¸€æ¬¡ã€‚æ™®é€šçš„å‡½æ•°ä¹Ÿæ˜¯â€œå¯å…±äº«çš„å¯¹è±¡ï¼Œå¯ä»¥åŒæ—¶åœ¨å¤šä¸ªä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨â€ã€‚ï¼ˆæ¨¡å¼æ˜¯æ­»çš„ï¼Œäººæ˜¯æ´»çš„ï¼ï¼‰</p>

<h2 id="éœ€æ±‚å‡çº§ä¸å®ç°">éœ€æ±‚å‡çº§ä¸å®ç°</h2>

<p>æ–°çš„éœ€æ±‚ï¼Œå¸®ç”¨æˆ·è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æƒ çš„æ‰“æŠ˜æ–¹å¼ã€‚ç”¨æˆ·ä¹°å•çš„æ—¶å€™è‡ªåŠ¨åˆ¤æ–­å¥½äº†æœ€åˆ’ç®—çš„æ‰“æŠ˜å¹¶è¿”å›åº”ä»˜æ¬¾ã€‚</p>

<p>è§£å†³æ–¹æ¡ˆï¼š</p>

<p>è¿­ä»£ä¸€ä¸ªå‡½æ•°åˆ—è¡¨ï¼Œå¹¶æ‰¾å‡ºæŠ˜æ‰£é¢åº¦æœ€å¤§çš„ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code>promos = [fidelity_promo, bulk_item_promo, large_order_promo]

def best_promo(order):
    return max(promo(order) for promo in promos) # ç”Ÿæˆå™¨è¡¨è¾¾å¼ ç®€æ´æœ‰åŠ›ï¼
</code></pre>

<p>æµ‹è¯•ç”¨ä¾‹ï¼š</p>

<pre><code>joe = Customer('John Doe', 0)
ann = Customer('Ann Smith', 1100)
cart = [LineItem('banana', 4, .5), 
        LineItem('apple', 10, 1.5), 
        LineItem('watermellon', 5, 5.0)]
print(Order(joe, cart, best_promo))
print(Order(ann, cart, best_promo))
banana_cart = [LineItem('banana', 30, .5), 
                LineItem('apple', 10, 1.5)]
print(Order(joe, banana_cart, best_promo))
long_order = [LineItem(str(item_code), 1, 1.0) for item_code in range(10)]
print(Order(joe, long_order, best_promo))
print(Order(joe, cart, best_promo))
</code></pre>

<p>ä»¥ä¸Šå‡½æ•°åˆ—è¡¨çš„æ–¹å¼è™½ç„¶ç®€æ´æ˜“è¯»ï¼Œä½†æœ‰å®¹æ˜“è¢«å¿½ç•¥çš„ç¼ºé™·ï¼Œæ–°æ·»åŠ çš„ä¿ƒé”€ç­–ç•¥ï¼Œè¦æ·»åŠ åˆ°promosåˆ—è¡¨ä¸­ï¼Œå¦åˆ™å‡ºé—®é¢˜ã€‚</p>

<p>è§£å†³æ–¹æ¡ˆæ˜¯åˆ©ç”¨å†…ç½®å‡½æ•°globals():
globals()è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºå½“å‰çš„å…¨å±€ç¬¦å·è¡¨ã€‚è¿™ä¸ªç¬¦å·è¡¨å§‹ç»ˆé’ˆå¯¹å½“å‰æ¨¡å—ï¼ˆå¯¹å‡½æ•°æˆ–æ–¹æ³•æ¥è¯´ï¼Œæ˜¯æŒ‡å®šä¹‰å®ƒä»¬çš„æ¨¡å—ï¼Œè€Œä¸æ˜¯è°ƒç”¨å®ƒä»¬çš„æ¨¡å—ï¼‰ã€‚</p>

<p>å€ŸåŠ©globals å‡½æ•°å¸®åŠ© best_promo è‡ªåŠ¨æ‰¾åˆ°å…¶ä»–å¯ç”¨çš„ *_promo å‡½æ•°ï¼Œå®ç°å¦‚ä¸‹ï¼š</p>

<pre><code>promos = [globals()[name] for name in globals()
            if name.endswith('_promo')
            and name != 'best_promo']

def best_promo(order):
    return max(promo(order) for promo in promos)
</code></pre>

<p>æµ‹è¯•ç”¨ä¾‹:</p>

<pre><code>joe = Customer('John Doe', 0)
ann = Customer('Ann Smith', 1100)
cart = [LineItem('banana', 4, .5), 
        LineItem('apple', 10, 1.5), 
        LineItem('watermellon', 5, 5.0)]
print(Order(joe, cart, best_promo))
print(Order(ann, cart, best_promo))
banana_cart = [LineItem('banana', 30, .5), 
                LineItem('apple', 10, 1.5)]
print(Order(joe, banana_cart, best_promo))
long_order = [LineItem(str(item_code), 1, 1.0) for item_code in range(10)]
print(Order(joe, long_order, best_promo))
print(Order(joe, cart, best_promo))
</code></pre>

<p>ä»¥ä¸Šçš„æ”¹è¿›å·²ç»æŒºå¥½çš„äº†ï¼Œä½†å…¶ä¸­æœ‰ä¸ªå°é™åˆ¶æ˜¯è¦æ±‚ç­–ç•¥å‡½æ•°éƒ½ä»¥_promoç»“æœã€‚
ä¸€ç§æ€è·¯æ˜¯æ—¢ç„¶è¦æ”¶é›†æ‰€æœ‰å¯ç”¨çš„ä¿ƒé”€å‡½æ•°ï¼Œå°±å¯ä»¥åœ¨å•ç‹¬çš„æ¨¡å—ä¸­ä¿å­˜ç­–ç•¥å‡½æ•°ï¼Œ
æŠŠbest_promoæ’é™¤åœ¨å¤–ã€‚
è¦å¯¼å…¥ promotions æ¨¡å—ï¼Œå¾—ç”¨åˆ°é«˜é˜¶å†…çœå‡½æ•°çš„ inspect æ¨¡å—ï¼Œinspect.getmembers å‡½æ•°ç”¨äºè·å–å¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯ promotions æ¨¡å—ï¼‰çš„å±æ€§ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„åˆ¤æ–­æ¡ä»¶ï¼ˆä¸€ä¸ªå¸ƒå°”å€¼å‡½æ•°ï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ inspect.isfunctionï¼Œåªè·å–æ¨¡å—ä¸­çš„å‡½æ•°ã€‚</p>

<p>å®ç°å¦‚ä¸‹:</p>

<p>(å¿½ç•¥æŠŠç­–ç•¥å‡½æ•°æ”¾åˆ°å•ç‹¬æ¨¡å—promotionçš„è¿‡ç¨‹)</p>

<pre><code>import promotion
import inspect

promos = [func for _, func in inspect.getmembers(promotion, inspect.isfunction)]

def best_promo(order):
    return max(promo(order) for promo in promos)
</code></pre>

<p>æµ‹è¯•ç”¨ä¾‹:</p>

<pre><code>joe = Customer('John Doe', 0)
ann = Customer('Ann Smith', 1100)
cart = [LineItem('banana', 4, .5), 
        LineItem('apple', 10, 1.5), 
        LineItem('watermellon', 5, 5.0)]
print(Order(joe, cart, best_promo))
print(Order(ann, cart, best_promo))
banana_cart = [LineItem('banana', 30, .5), 
                LineItem('apple', 10, 1.5)]
print(Order(joe, banana_cart, best_promo))
long_order = [LineItem(str(item_code), 1, 1.0) for item_code in range(10)]
print(Order(joe, long_order, best_promo))
print(Order(joe, cart, best_promo))
</code></pre>

<p>ä¿®æ”¹åï¼Œç»æµ‹è¯•å¯ä»¥æ˜¯è¡Œå¾—é€šçš„ï¼ŒæŠŠç­–ç•¥å‡½æ•°çš„å®ç°æ”¾åˆ°å•ç‹¬çš„æ¨¡å—ï¼Œé€»è¾‘æ¸…æ™°ï¼Œæ–¹ä¾¿æ‰©å±•ï¼Œ
å®šä¹‰å‡½æ•°ä¹Ÿæ›´åŠ çµæ´»è‡ªåœ¨ï¼Œä¸å¿…æ‹˜æ³¥äºå‡½æ•°åã€‚åˆ°æ­¤å¯èƒ½ä¼šè§‰å¾—å·²ç»æ”¹è¿›å¾—å·®ä¸å¤šäº†ã€‚ä½†å…¶å®æ˜¯æœ‰é—®é¢˜çš„ã€‚
promotions æ¨¡å—åªèƒ½åŒ…å«è®¡ç®—è®¢å•æŠ˜æ‰£çš„å‡½æ•°ï¼è¿™æ˜¯å¯¹ä»£ç çš„éšæ€§å‡è®¾ã€‚å¦‚æœæœ‰äººåœ¨ promotions æ¨¡å—ä¸­ä½¿ç”¨ä¸åŒçš„ç­¾åå®šä¹‰å‡½æ•°ï¼Œé‚£ä¹ˆ best_promo å‡½æ•°å°è¯•å°†å…¶åº”ç”¨åˆ°è®¢å•ä¸Šæ—¶ä¼šå‡ºé”™ã€‚(å®é™…ä¸Šä»¥_promoç»“å°¾æ ‡è®°ç­–ç•¥å‡½æ•°ä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ã€‚)
è§£å†³æ–¹æ¡ˆæ€è·¯ä¹‹ä¸€æ˜¯å¯ä»¥æ·»åŠ æ›´ä¸ºä¸¥æ ¼çš„æµ‹è¯•ï¼Œå®¡æŸ¥ä¼ ç»™å®ä¾‹çš„å‚æ•°ï¼Œè¿›ä¸€æ­¥è¿‡æ»¤å‡½æ•°ã€‚</p>

<p>ä½†æœ‰æ›´ç®€å•æ›´ä¼˜é›…åœ°æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š
ä½¿ç”¨ç®€å•çš„è£…é¥°å™¨æ¥å®ç°åŠ¨æ€æ”¶é›†ä¿ƒé”€æŠ˜æ‰£å‡½æ•°ï¼</p>

<p><strong>è£…é¥°å™¨çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯ï¼Œå®ƒä»¬åœ¨è¢«è£…é¥°çš„å‡½æ•°å®šä¹‰ä¹‹åç«‹å³è¿è¡Œã€‚
è¿™é€šå¸¸æ˜¯åœ¨å¯¼å…¥æ—¶(å³ Python åŠ è½½æ¨¡å—æ—¶)è€Œä¸æ˜¯è¿è¡Œæ—¶ã€‚</strong></p>

<p>promos åˆ—è¡¨ä¸­çš„å€¼ä½¿ç”¨ promotion è£…é¥°å™¨å¡«å……ï¼Œä»£ç é‡æ„å¦‚ä¸‹ï¼š</p>

<pre><code>promos = []

def promotion(promo_func):
    promos.append(promo_func)
    return promo_func


@promotion
def fidelity_promo(order):
    return order.total() * .05 if order.customer.fidelity &gt;= 1000 else 0

@promotion
def bulk_item_promo(order):
    discount = 0
    for item in order.cart:
        if item.quantity &gt;= 20:
            discount += item.total() * .1
    return discount

@promotion
def large_order_promo(order):
    distinct_items = {item.product for item in order.cart}
    if len(distinct_items) &gt;= 10:
        return order.total() * .07
    return 0


def best_promo(order):
    return max(promo(order) for promo in promos)
</code></pre>

<p>æµ‹è¯•ç”¨ä¾‹ï¼š</p>

<pre><code>joe = Customer('John Doe', 0)
ann = Customer('Ann Smith', 1100)
cart = [LineItem('banana', 4, .5), 
        LineItem('apple', 10, 1.5), 
        LineItem('watermellon', 5, 5.0)]
print(Order(joe, cart, best_promo))
print(Order(ann, cart, best_promo))
banana_cart = [LineItem('banana', 30, .5), 
                LineItem('apple', 10, 1.5)]
print(Order(joe, banana_cart, best_promo))
long_order = [LineItem(str(item_code), 1, 1.0) for item_code in range(10)]
print(Order(joe, long_order, best_promo))
print(Order(joe, cart, best_promo))
</code></pre>

<p>åˆ°æ­¤ï¼Œå¾—åˆ°äº†ä¸€ä¸ªç›¸å¯¹å®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p>

<ul>
<li>ä¿ƒé”€ç­–ç•¥å‡½æ•°æ— éœ€ä½¿ç”¨ç‰¹æ®Šçš„åç§°ï¼ˆå³ä¸ç”¨ä»¥ _promo ç»“å°¾ï¼‰ã€‚</li>
<li>@promotion è£…é¥°å™¨çªå‡ºäº†è¢«è£…é¥°çš„å‡½æ•°çš„ä½œç”¨ï¼Œè¿˜ä¾¿äºä¸´æ—¶ç¦ç”¨æŸä¸ªä¿ƒé”€ç­–ç•¥ï¼šåªéœ€æŠŠè£…é¥°å™¨æ³¨é‡Šæ‰ã€‚</li>
<li>ä¿ƒé”€æŠ˜æ‰£ç­–ç•¥å¯ä»¥åœ¨å…¶ä»–æ¨¡å—ä¸­å®šä¹‰ï¼Œåœ¨ç³»ç»Ÿä¸­çš„ä»»ä½•åœ°æ–¹éƒ½è¡Œï¼Œåªè¦ä½¿ç”¨ @promotion è£…é¥°å³å¯ã€‚</li>
</ul>

<p>æœ¬æ–‡å†…å®¹å‚è€ƒæ•´ç†è‡ªã€Šæµç•…çš„Pythonã€‹ç›¸å…³çš„å†…å®¹ï¼Œåšäº†å°‘è®¸ä¿®æ”¹ã€‚ç¤ºä¾‹ä»£ç çš„é€æ­¥ä¼˜åŒ–å¾ˆæ£’ğŸ‘ï¼Œæ¶‰åŠä¸å°‘Pythonçš„çŸ¥è¯†ç‚¹çš„å·§å¦™åº”ç”¨ï¼Œç²¾å½©ï¼</p>
                        </div>

                        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>åŸæ–‡ä½œè€…ï¼š</strong><a rel="author" href="https://neo0moriarty.github.io/">neo0moriarty</a></li>
        <li style="word-break:break-all"><strong>åŸæ–‡é“¾æ¥ï¼š</strong><a href="https://neo0moriarty.github.io/python-strategy-order-discount/">https://neo0moriarty.github.io/python-strategy-order-discount/</a></li>
        <li><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…è®¸å¯åè®®</a>è¿›è¡Œè®¸å¯ï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼ˆä½œè€…ï¼ŒåŸæ–‡é“¾æ¥ï¼‰ï¼Œå•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒã€‚</li>
    </ul>
</div>
<br/>



                        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/python-virtualenv/">Pythonçš„virtualenvä½¿ç”¨</a></li>
        
        <li><a href="/python-closure/">Pythonçš„ä½œç”¨åŸŸä¸é—­åŒ…æµ…æ</a></li>
        
        <li><a href="/python-map-filter/">Pythonä¸­mapã€filterå’Œreduceçš„æ›¿ä»£å“</a></li>
        
        <li><a href="/python-manual-help/">æŸ¥çœ‹Pythonå¸®åŠ©æ–‡æ¡£çš„å‡ ç§æ–¹å¼</a></li>
        
        <li><a href="/python-memoryview/">Python3ä¸­çš„å†…å­˜è§†å›¾memoryview</a></li>
        
    </ul>
</div>


                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="https://neo0moriarty.github.io/tags/python">python</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "neo0moriarty/neo0moriarty.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://neo0moriarty.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">æœ€è¿‘æ–‡ç« </h3>
<ul class="widget-list">
    
    <li>
        <a href="https://neo0moriarty.github.io/mac-cleanup-app/" title="Macæ¸…ç†è½¯ä»¶">Macæ¸…ç†è½¯ä»¶</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/h265-compress-video/" title="ä½¿ç”¨H.265è§†é¢‘ç¼–ç å‹ç¼©è§†é¢‘æ–‡ä»¶">ä½¿ç”¨H.265è§†é¢‘ç¼–ç å‹ç¼©è§†é¢‘æ–‡ä»¶</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/mac-hugo-blog-record/" title="Macä¸‹Hugoæ­å»ºè®°å½•">Macä¸‹Hugoæ­å»ºè®°å½•</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/mac-usb-iso/" title="Macä¸‹æ ¼å¼åŒ–Uç›˜å¹¶åˆ¶ä½œisoç³»ç»Ÿå¯åŠ¨">Macä¸‹æ ¼å¼åŒ–Uç›˜å¹¶åˆ¶ä½œisoç³»ç»Ÿå¯åŠ¨</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/ubuntu-mount-exfat/" title="ubuntuæŒ‚è½½exfatæ ¼å¼çš„ç¡¬ç›˜">ubuntuæŒ‚è½½exfatæ ¼å¼çš„ç¡¬ç›˜</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/install-neovim/" title="Neovimå®‰è£…">Neovimå®‰è£…</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/install-full-vim/" title="Mac å®‰è£…æœ€å®Œæ•´çš„ Vim">Mac å®‰è£…æœ€å®Œæ•´çš„ Vim</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/python-website/" title="Pythonç›¸å…³ç½‘å€æ”¶é›†">Pythonç›¸å…³ç½‘å€æ”¶é›†</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/python-round/" title="Pythonä¸­ä½¿ç”¨roundå‡½æ•°è¦æ³¨æ„çš„äº‹">Pythonä¸­ä½¿ç”¨roundå‡½æ•°è¦æ³¨æ„çš„äº‹</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/python-binary-tree/" title="Pythonå®ç°å’Œéå†äºŒå‰æ ‘">Pythonå®ç°å’Œéå†äºŒå‰æ ‘</a>
    </li>
    
</ul>
    </section>

    

    

    <section class="widget">
        <h3 class="widget-title">æ ‡ç­¾</h3>
<div class="tagcloud">
    
    <a href="https://neo0moriarty.github.io/tags/algorithm/">algorithm</a>
    
    <a href="https://neo0moriarty.github.io/tags/blog/">blog</a>
    
    <a href="https://neo0moriarty.github.io/tags/book/">book</a>
    
    <a href="https://neo0moriarty.github.io/tags/crawler/">crawler</a>
    
    <a href="https://neo0moriarty.github.io/tags/dev/">dev</a>
    
    <a href="https://neo0moriarty.github.io/tags/os/">os</a>
    
    <a href="https://neo0moriarty.github.io/tags/python/">python</a>
    
    <a href="https://neo0moriarty.github.io/tags/study/">study</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">å‹æƒ…é“¾æ¥</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://github.com/neo0moriarty" title="neo0moriarty">neo0moriarty</a>
        </li>
        
        <li>
            <a target="_blank" href="https://coolshell.cn/" title="é…·å£³ â€“ CoolShell.cn">é…·å£³ â€“ CoolShell.cn</a>
        </li>
        
        <li>
            <a target="_blank" href="https://www.flysnow.org" title="é£é›ªæ— æƒ…çš„åšå®¢">é£é›ªæ— æƒ…çš„åšå®¢</a>
        </li>
        
        <li>
            <a target="_blank" href="https://github.com/rujews/maupassant-hugo" title="åšå®¢ä¸»é¢˜maupassant">åšå®¢ä¸»é¢˜maupassant</a>
        </li>
        
    </ul>
</section>


    
</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        
    </div>
</footer>


    
    <script type="text/javascript">
        
        (function () {
            $("pre code").parent().addClass("line-numbers")
        }());

        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script type="text/javascript" src="/js/prism.js" async="true"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/js/totop.js?v=0.0.0" async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-106906316-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






</body>
</html>
