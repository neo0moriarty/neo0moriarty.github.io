<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.59.1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>豆瓣影视信息的一些简单分析 | neo0moriarty</title>
    <meta property="og:title" content="豆瓣影视信息的一些简单分析 - neo0moriarty">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2017-12-23T00:00:00&#43;08:00">
        
        
    <meta property="article:modified_time" content="2017-12-23T00:00:00&#43;08:00">
        
    <meta name="Keywords" content="[豆瓣电影分析 豆瓣电影统计]">
    <meta name="description" content="豆瓣影视信息的一些简单分析">
        
    <meta name="author" content="neo0moriarty">
    <meta property="og:url" content="https://neo0moriarty.github.io/douban-movie-stati/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/normalize.css">
    
        <link rel="stylesheet" href="/css/prism.css">
    
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    


    
    
</head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://neo0moriarty.github.io/">
                        neo0moriarty
                    </a>
                
                <p class="description">o(╯□╰)o  (゜-゜)つロ  o(╯□╰)o</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://neo0moriarty.github.io/">首页</a>
                    
                    <a  href="https://neo0moriarty.github.io/archives/" title="归档">归档</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
        
        
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">豆瓣影视信息的一些简单分析</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2017年12月23日
                        </date>
                        
                        
                        
                        <div class="post-content">
                            <p>之前把<a href="https://movie.douban.com/">豆瓣电影</a>下的影视信息抓取了一遍，现在可以进行一些简单的分析。</p>

<hr />

<p>抓取的信息一共有82040条，保存在MongoDB中。
每一条信息的字段如下所示：</p>

<pre><code>&gt; use douban
switched to db douban
&gt; db.subjects.find().count()
82040
&gt; db.subjects.find().limit(1)
{ &quot;_id&quot; : ObjectId(&quot;5a322ab27b514a3dfa645f20&quot;), &quot;detail_url&quot; : &quot;https://movie.douban.com/subject/1292052/&quot;, &quot;subject_id&quot; : &quot;1292052&quot;, &quot;name&quot; : &quot;肖申克的救赎 The Shawshank Redemption&quot;, &quot;year&quot; : 1994, &quot;more_name&quot; : &quot;月黑高飞(港) / 刺激1995(台) / 地狱诺言 / 铁窗岁月 / 消香克的救赎&quot;, &quot;full_name&quot; : &quot;肖申克的救赎 The Shawshank Redemption / 月黑高飞(港) / 刺激1995(台) / 地狱诺言 / 铁窗岁月 / 消香克的救赎&quot;, &quot;score&quot; : 9.6, &quot;count&quot; : 926181, &quot;movie_intro&quot; : &quot;20世纪40年代末，小有成就的青年银行家安迪（蒂姆·罗宾斯 Tim Robbins 饰）因涉嫌杀害妻子及她的情人而锒铛入狱。在这座名为肖申克的监狱内，希望似乎虚无缥缈，终身监禁的惩罚无疑注定了安迪接下来灰暗绝望的人生。未过多久，安迪尝试接近囚犯中颇有声望的瑞德（摩根·弗里曼 Morgan Freeman 饰），请求对方帮自己搞来小锤子。以此为契机，二人逐渐熟稔，安迪也仿佛在鱼龙混杂、罪恶横生、黑白混淆的牢狱中找到属于自己的求生之道。他利用自身的专业知识，帮助监狱管理层逃税、洗黑钱，同时凭借与瑞德的交往在犯人中间也渐渐受到礼遇。表面看来，他已如瑞德那样对那堵高墙从憎恨转变为处之泰然，但是对自由的渴望仍促使他朝着心中的希望和目标前进。而关于其罪行的真相，似乎更使这一切朝前推进了一步……&quot;, &quot;top_num&quot; : 1, &quot;imdb&quot; : &quot;tt0111161&quot;, &quot;imdb_url&quot; : &quot;http://www.imdb.com/title/tt0111161&quot;, &quot;have_seen_count&quot; : 1172419, &quot;want_see_count&quot; : 93389, &quot;short_comment_count&quot; : 217458, &quot;comment_count&quot; : 5662, &quot;is_top250&quot; : 1, &quot;runtime&quot; : 142, &quot;director&quot; : [ &quot;弗兰克·德拉邦特&quot; ], &quot;actor&quot; : [ &quot;蒂姆·罗宾斯&quot;, &quot;摩根·弗里曼&quot;, &quot;鲍勃·冈顿&quot;, &quot;威廉姆·赛德勒&quot;, &quot;克兰西·布朗&quot;, &quot;吉尔·贝罗斯&quot;, &quot;马克·罗斯顿&quot;, &quot;詹姆斯·惠特摩&quot;, &quot;杰弗里·德曼&quot;, &quot;拉里·布兰登伯格&quot;, &quot;尼尔·吉恩托利&quot;, &quot;布赖恩·利比&quot;, &quot;大卫·普罗瓦尔&quot;, &quot;约瑟夫·劳格诺&quot;, &quot;祖德·塞克利拉&quot; ], &quot;scriptwriter&quot; : [ &quot;弗兰克·德拉邦特&quot;, &quot;斯蒂芬·金&quot; ], &quot;region&quot; : [ &quot;美国&quot; ], &quot;category&quot; : &quot;电影&quot;, &quot;type&quot; : [ &quot;剧情&quot;, &quot;犯罪&quot; ], &quot;language&quot; : [ &quot;英语&quot; ], &quot;update_time&quot; : &quot;2017-12-19 15:53:06&quot; }
</code></pre>

<p>字段挺多，导出一些字段出来分析。
<strong>用mongoexport从MongoDB导出：</strong></p>

<pre><code>mongoexport -d douban -c subjects --type json -f subject_id,category,name,score,count,have_seen_count,want_see_count,short_comment_count,comment_count,year -o subjects.json
</code></pre>

<p>就可以在ipython中读取subjects.json进行分析了。</p>

<p><a href="/subjects.json">subjects.json文件(新标签打开)</a>大小20M，共82040行。</p>

<p>subjects.json文件每一行是一条信息(字符串)：</p>

<pre><code>In [55]: open(path).readline()
Out[55]: '{&quot;_id&quot;:{&quot;$oid&quot;:&quot;5a322ab27b514a3dfa645f20&quot;},&quot;subject_id&quot;:&quot;1292052&quot;,&quot;name&quot;:&quot;肖申克的救赎 The Shawshank Redemption&quot;,&quot;score&quot;:9.6,&quot;count&quot;:926181,&quot;have_seen_count&quot;:1172419,&quot;want_see_count&quot;:93389,&quot;short_comment_count&quot;:217458,&quot;comment_count&quot;:5662,&quot;category&quot;:&quot;电影&quot;,&quot;year&quot;:1994}\n'
</code></pre>

<p><strong>读取整个文件，加载成Python中的列表对象(将每一行load成字典，存入列表):</strong></p>

<pre><code>In [57]: import json

In [58]: path='subjects.json'

In [59]: records = [json.loads(line) for line in open(path)]

In [60]: len(records)
Out[60]: 82040

In [61]: import sys

In [62]: sys.getsizeof(records)
Out[62]: 732816

In [63]: records[0]
Out[63]: 
{'_id': {'$oid': '5a322ab27b514a3dfa645f20'},
 'category': '电影',
 'comment_count': 5662,
 'count': 926181,
 'have_seen_count': 1172419,
 'name': '肖申克的救赎 The Shawshank Redemption',
 'score': 9.6,
 'short_comment_count': 217458,
 'subject_id': '1292052',
 'year': 1994,
 'want_see_count': 93389}
</code></pre>

<p><strong>查看某个字段的值的汇总数:</strong></p>

<pre><code>In [89]: def count_col_value(col, sequences):
    ...:     d = {}
    ...:     for seq in sequences:
    ...:         col_value = seq.get(col)
    ...:         if col_value not in d:
    ...:             d[col_value] = 1
    ...:         else:
    ...:             d[col_value] += 1
    ...:     return d
    
# 统计不同的视频类别的个数
In [91]: count_col_value('category', records)
Out[91]: {'动画': 3608, '电影': 58576, '电视剧': 15452, '短片': 630, '纪录片': 1967, '综艺': 1807}

# 统计不同年份的视频个数
In [90]: count_col_value('year', records)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
&lt;ipython-input-90-5fefa6e219bf&gt; in &lt;module&gt;()
----&gt; 1 count_col_value('year', records)
&lt;ipython-input-89-f0fb1190d4b9&gt; in count_col_value(col, sequences)
      3     for seq in sequences:
      4         col_value = seq.get(col)
----&gt; 5         if col_value not in d:
      6             d[col_value] = 1
      7         else:
TypeError: unhashable type: 'list'

发现报错了，原因是有的年份数据是空列表[]，需要过滤:

In [86]: for i, v  in enumerate(records):
    ...:     if type(v['year']) == list:
    ...:         records[i]['year'] = 1900
    ...:         

In [87]: count_col_value('year', records)
Out[87]: 
{
 1900: 300,
 ...
 2010: 4179,
 2011: 4171,
 2012: 4524,
 2013: 4570,
 2014: 4673,
 2015: 4844,
 2016: 4571,
 2017: 2484,
 2018: 1}
 
# count_col_value更好的实现方式 利用defaultdict
In [94]: from collections import defaultdict

In [95]: def count_col_value(col, sequences):
    ...:     d = defaultdict(int)
    ...:     for seq in sequences:
    ...:         col_value = seq.get(col)
    ...:         d[col_value] += 1
    ...:     return d
    
# 如果序列中的字段值都是可散列的，可以利用collections模块中的Counter函数直接计算，这个例子并不满足
from collections import Counter
</code></pre>

<p><strong>利用pandas分析：</strong></p>

<pre><code>In [105]: from pandas import DataFrame 

In [106]: frame = DataFrame(records)

In [107]: frame
Out[107]: 
                                        _id category  comment_count     count  \
0      {'$oid': '5a322ab27b514a3dfa645f20'}       电影           5662  926181.0   
1      {'$oid': '5a328fc17b514a56a819a18a'}       电影           2268  521073.0   
2      {'$oid': '5a328fc27b514a56a819a18b'}       电影           5037  795797.0   
3      {'$oid': '5a328fc97b514a56a819a18c'}       电影           4031  509034.0   

       have_seen_count                                               name  \
0              1172419                    肖申克的救赎 The Shawshank Redemption   
1               642465                                      机器人总动员 WALL·E   
2               991718                                     盗梦空间 Inception   
3               572801                                  星际穿越 Interstellar   

       score  short_comment_count subject_id  want_see_count  year  
0        9.6               217458    1292052           93389  1994  
1        9.3               116614    2131459           66201  2008  
2        9.3               206789    3541415           95554  2010  
3        9.1               181341    1889243           66751  2014  

...

[82040 rows x 11 columns]

In [110]: type(frame)
Out[110]: pandas.core.frame.DataFrame

In [111]: type(frame['year'])
Out[111]: pandas.core.series.Series

# frame 输出形式是摘要视图(summary view)，主要用于较大的DataFrame对象，frame['year']是Series对象，有一个value_counts方法，该方法可以得到统计信息：

In [108]: year_counts = frame['year'].value_counts()

In [109]: year_counts
Out[109]: 
2015    4844
2014    4673
2016    4571
2013    4570
2012    4524
2010    4179
2011    4171
2009    3840
2008    3453
...
1907      15
1906      15
1917      15
1902      14
1908      12
1898      12
1894      11
1905      11
Name: year, Length: 133, dtype: int64

</code></pre>

<p>调用year_counts对象的<strong>plot方法</strong>得到水平条形图。如下图所示
iPython需要以pylab方式打开：ipython &ndash;pylab</p>

<pre><code># 对比分析视频数量前30的年份
In [12]: year_counts[:30].plot(kind='barh', rot=0)
Out[12]: &lt;matplotlib.axes._subplots.AxesSubplot at 0x10ec873c8&gt;
</code></pre>

<p><img src="/year_movies_30.png" alt="" /></p>

<p>统计各个评分的评分人数：</p>

<pre><code>In [29]: score_counts = frame['score'].value_counts()

In [30]: score_counts
Out[30]: 
7.5    2868
7.4    2862
7.3    2842
7.6    2805
7.7    2700
7.2    2597
7.1    2571
7.8    2557
6.8    2521
6.7    2431
7.0    2394
6.6    2326
6.5    2254
...
2.4      66
2.3      58
9.8      26
2.2      25
2.1      14
9.9       2
Name: score, Length: 79, dtype: int64

</code></pre>

<p>按照评分人数从多到少排序：</p>

<pre><code>In [37]: frame.sort_values(by='count', ascending=False)
Out[37]:  # 只截取前十条
                                        _id category  comment_count     count  \
0      {'$oid': '5a322ab27b514a3dfa645f20'}       电影           5662  926181.0   
216    {'$oid': '5a3290e87b514a56a819a261'}       电影           3720  878690.0   
2      {'$oid': '5a328fc27b514a56a819a18b'}       电影           5037  795797.0   
237    {'$oid': '5a3291087b514a56a819a276'}       电影           2923  747410.0   
214    {'$oid': '5a3290e57b514a56a819a25f'}       电影           3628  705367.0   
240    {'$oid': '5a32910c7b514a56a819a279'}       电影           2490  698238.0   
239    {'$oid': '5a32910b7b514a56a819a278'}       电影           1672  687450.0   
217    {'$oid': '5a3290e97b514a56a819a262'}       电影           4912  668860.0   
164    {'$oid': '5a32909e7b514a56a819a22d'}       电影           4521  633554.0   
215    {'$oid': '5a3290e77b514a56a819a260'}       电影           4646  621615.0 

       have_seen_count                                               name  \
0              1172419                    肖申克的救赎 The Shawshank Redemption   
216            1123711                                       这个杀手不太冷 Léon   
2               991718                                     盗梦空间 Inception   
237             990962                                  阿甘正传 Forrest Gump   
214             870282                                   三傻大闹宝莱坞 3 Idiots   
240             895285                                      千与千寻 千と千尋の神隠し   
239             911874                                      泰坦尼克号 Titanic   
217             840261                                               霸王别姬   
164             799718                                               让子弹飞   
215             808823         海上钢琴师 La leggenda del pianista sull'oceano 

       score  short_comment_count subject_id  want_see_count  year  
0        9.6               217458    1292052           93389  1994  
216      9.4               200203    1295644           67542  1994  
2        9.3               206789    3541415           95554  2010  
237      9.4               150394    1292720           57113  1994  
214      9.1               197912    3793023           51294  2009  
240      9.2               141202    1291561           49424  2001  
239      9.2               127811    1292722           27410  1997  
217      9.5               177352    1291546           78879  1993  
164      8.7               158884    3742360           37346  2010  
215      9.2               135566    1292001           99572  1998  
</code></pre>

<p>通过以上示例，发现利用Python处理和分析数据的确是挺方便的，特别是配合pandas、matplotlib等强大的工具。</p>
                        </div>

                        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://neo0moriarty.github.io/">neo0moriarty</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://neo0moriarty.github.io/douban-movie-stati/">https://neo0moriarty.github.io/douban-movie-stati/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



                        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/scrapy-rakuten/">Scrapy抓取日本乐天的前五大品牌洗衣机的评论</a></li>
        
        <li><a href="/scrapy-restart/">Scrapy断点续爬</a></li>
        
        <li><a href="/two-crawler-books/">两本爬虫相关的书籍</a></li>
        
        <li><a href="/scrapy-sum/">Scrapy抓取结果汇总分析</a></li>
        
        <li><a href="/douban-movie-count/">抓取瓣所有电影详情页并统计豆瓣收录的电影的数量</a></li>
        
    </ul>
</div>


                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="https://neo0moriarty.github.io/tags/crawler">crawler</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "neo0moriarty/neo0moriarty.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://neo0moriarty.github.io/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://neo0moriarty.github.io/h265-compress-video/" title="ffmpeg使用H265编码压缩视频">ffmpeg使用H265编码压缩视频</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/mac-cleanup-app/" title="Mac清理软件">Mac清理软件</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/mac-hugo-blog-record/" title="Mac下Hugo搭建记录">Mac下Hugo搭建记录</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/mac-usb-iso/" title="Mac下制作iso系统启动">Mac下制作iso系统启动</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/ubuntu-mount-exfat/" title="ubuntu挂载exfat格式的硬盘">ubuntu挂载exfat格式的硬盘</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/install-neovim/" title="Neovim安装">Neovim安装</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/install-full-vim/" title="Mac 安装最完整的 Vim">Mac 安装最完整的 Vim</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/python-website/" title="Python相关网址收集">Python相关网址收集</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/python-round/" title="Python的round函数">Python的round函数</a>
    </li>
    
    <li>
        <a href="https://neo0moriarty.github.io/python-binary-tree/" title="Python实现和遍历二叉树">Python实现和遍历二叉树</a>
    </li>
    
</ul>
    </section>

    

    

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="https://neo0moriarty.github.io/tags/algorithm/">algorithm</a>
    
    <a href="https://neo0moriarty.github.io/tags/blog/">blog</a>
    
    <a href="https://neo0moriarty.github.io/tags/book/">book</a>
    
    <a href="https://neo0moriarty.github.io/tags/crawler/">crawler</a>
    
    <a href="https://neo0moriarty.github.io/tags/dev/">dev</a>
    
    <a href="https://neo0moriarty.github.io/tags/os/">os</a>
    
    <a href="https://neo0moriarty.github.io/tags/python/">python</a>
    
    <a href="https://neo0moriarty.github.io/tags/study/">study</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://github.com/neo0moriarty" title="neo0moriarty">neo0moriarty</a>
        </li>
        
        <li>
            <a target="_blank" href="https://coolshell.cn/" title="酷壳 – CoolShell.cn">酷壳 – CoolShell.cn</a>
        </li>
        
        <li>
            <a target="_blank" href="https://www.flysnow.org" title="飞雪无情的博客">飞雪无情的博客</a>
        </li>
        
        <li>
            <a target="_blank" href="https://github.com/rujews/maupassant-hugo" title="博客主题maupassant">博客主题maupassant</a>
        </li>
        
    </ul>
</section>


    
</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        
    </div>
</footer>


    
    <script type="text/javascript">
        
        (function () {
            $("pre code").parent().addClass("line-numbers")
        }());

        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script type="text/javascript" src="/js/prism.js" async="true"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/js/totop.js?v=0.0.0" async=""></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-106906316-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






</body>
</html>
